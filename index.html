<div style="max-width: 620px; margin: 40px auto; padding: 32px; background: #fff; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.07); font-family:'Segoe UI',sans-serif;color:#1a1a1a;">

  <h2 style="text-align:center;font-size:24px;font-weight:700;margin-bottom:30px;color:#5a52ff;">
    Signalez une coupure d’électricité dans votre ville
  </h2>

  <label for="ville" style="font-weight:600;display:block;margin-bottom:8px;">Votre ville</label>
  <!-- on a retiré autocomplete="off" -->
  <input id="ville" type="text" placeholder="Ex. : Lyon" 
         style="width:100%;padding:14px 16px;border:1px solid #ccc;border-radius:10px;
                font-size:16px;margin-bottom:28px;box-sizing:border-box;">

  <label style="font-weight:600;display:block;margin-bottom:12px;">Avez-vous eu une coupure ?</label>
  <div style="display:flex;gap:20px;margin-bottom:32px;">
    <label style="flex:1;background:#f1f3ff;padding:14px 16px;border-radius:10px;
                  text-align:center;cursor:pointer;border:2px solid transparent;
                  transition:border-color .2s;">
      <input type="radio" name="coupure" value="Oui" style="display:none;">
      <span style="font-weight:600;color:#5a52ff;">Oui</span>
    </label>
    <label style="flex:1;background:#f1f3ff;padding:14px 16px;border-radius:10px;
                  text-align:center;cursor:pointer;border:2px solid transparent;
                  transition:border-color .2s;">
      <input type="radio" name="coupure" value="Non" style="display:none;">
      <span style="font-weight:600;color:#0fc4b2;">Non</span>
    </label>
  </div>

  <button onclick="envoyerFormulaire()" 
          style="width:100%;padding:16px;
                 background:linear-gradient(to right,#5a52ff,#0fc4b2);
                 color:#fff;border:none;border-radius:12px;
                 font-size:17px;font-weight:bold;cursor:pointer;
                 transition:background .3s;">
    Envoyer
  </button>

  <p id="confirmation" 
     style="display:none;margin-top:20px;color:#5a52ff;
            text-align:center;font-weight:600;">
    Merci, votre réponse a bien été envoyée !
  </p>
</div>

<!-- 1) On charge d’abord Google Maps -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD-rJWgZwUxtjsLZ-w0VPOG2e4fVUmJGNA&libraries=places"></script>

<script>
  let villeValide = "";

  // 2) Puis on initialise l'autocomplete après tout le chargement
  window.onload = function() {
    const input = document.getElementById("ville");
    const auto = new google.maps.places.Autocomplete(input, {
      types: ["(cities)"],
      componentRestrictions: { country: "fr" }
    });

    // On restreint le champ à la propriété "name" (nom de la ville)
    auto.setFields(["name"]);

    // Quand on choisit une suggestion, on stocke la valeur
    auto.addListener("place_changed", () => {
      const place = auto.getPlace();
      villeValide = place.name || "";
    });

    // Si l'utilisateur tape ou modifie après sélection, on réinitialise
    input.addEventListener("input", () => {
      villeValide = "";
    });
  };

  // 3) Gestion des boutons Oui/Non pour l'effet visuel
  const radios = document.querySelectorAll('input[name="coupure"]');
  const labels = document.querySelectorAll('label[style*="cursor:pointer"]');
  labels.forEach((lbl, i) => {
    lbl.onclick = () => {
      radios[i].checked = true;
      labels.forEach(l => l.style.borderColor = "transparent");
      lbl.style.borderColor = "#ffb81d";
    };
  });

  // 4) Envoi vers Apps Script
  function envoyerFormulaire() {
    const villeInput = document.getElementById("ville").value;
    const coupure = document.querySelector('input[name="coupure"]:checked')?.value;

    if (!villeInput || !coupure || villeInput !== villeValide) {
      alert("Merci de choisir une ville dans la liste et de répondre à la question.");
      return;
    }

    fetch("TON_URL_APPS_SCRIPT", {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ ville: villeValide, coupure })
    });

    document.getElementById("ville").value = "";
    radios.forEach(r => r.checked = false);
    labels.forEach(l => l.style.borderColor = "transparent");
    document.getElementById("confirmation").style.display = "block";
  }
</script>


