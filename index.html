<div style="max-width:620px;margin:40px auto;padding:32px;background:#fff;border-radius:20px;
            box-shadow:0 10px 30px rgba(0,0,0,0.07);font-family:'Segoe UI',sans-serif;color:#1a1a1a;">

  <h2 style="text-align:center;font-size:24px;font-weight:700;margin-bottom:30px;color:#5a52ff;">
    Signalez une coupure d’électricité dans votre ville
  </h2>

  <label for="ville" style="font-weight:600;display:block;margin-bottom:8px;">Votre ville</label>
  <input id="ville" list="cities" placeholder="Ex. : Lyon"
         style="width:100%;padding:14px 16px;border:1px solid #ccc;border-radius:10px;
                font-size:16px;margin-bottom:28px;box-sizing:border-box;">
  <datalist id="cities"></datalist>

  <label style="font-weight:600;display:block;margin-bottom:12px;">Avez-vous eu une coupure ?</label>
  <div style="display:flex;gap:20px;margin-bottom:32px;">
    <label class="opt" data-value="Oui"
           style="flex:1;background:#f1f3ff;padding:14px 16px;border-radius:10px;
                  text-align:center;cursor:pointer;border:2px solid transparent;
                  transition:border-color .2s;">Oui</label>
    <label class="opt" data-value="Non"
           style="flex:1;background:#f1f3ff;padding:14px 16px;border-radius:10px;
                  text-align:center;cursor:pointer;border:2px solid transparent;
                  transition:border-color .2s;">Non</label>
  </div>

  <button id="submitBtn"
          style="width:100%;padding:16px;background:linear-gradient(to right,#5a52ff,#0fc4b2);
                 color:#fff;border:none;border-radius:12px;font-size:17px;font-weight:bold;
                 cursor:pointer;transition:background .3s;">Envoyer</button>

  <p id="confirmation"
     style="display:none;margin-top:20px;color:#5a52ff;text-align:center;font-weight:600;">
    Merci, votre réponse a bien été envoyée !
  </p>
</div>

<script>
  let validCities = [];
  let choixCoupure = "";

  document.addEventListener("DOMContentLoaded", () => {
    const input = document.getElementById("ville");
    const dataList = document.getElementById("cities");
    const opts = document.querySelectorAll(".opt");
    const btn = document.getElementById("submitBtn");

    // 1) À chaque saisie, on interroge Nominatim
    input.addEventListener("input", () => {
      const q = input.value.trim();
      if (q.length < 2) {
        dataList.innerHTML = "";
        validCities = [];
        return;
      }
      fetch(`https://nominatim.openstreetmap.org/search?city=${encodeURIComponent(q)}&country=France&format=json&limit=5`)
        .then(res => res.json())
        .then(list => {
          dataList.innerHTML = "";
          validCities = [];
          list.forEach(item => {
            const name = item.display_name.split(',')[0];
            const opt = document.createElement('option');
            opt.value = name;
            dataList.appendChild(opt);
            if (!validCities.includes(name)) validCities.push(name);
          });
        })
        .catch(() => {
          dataList.innerHTML = "";
          validCities = [];
        });
    });

    // 2) Gestion Oui/Non
    opts.forEach(label => {
      label.addEventListener("click", () => {
        choixCoupure = label.dataset.value;
        opts.forEach(l => l.style.borderColor = "transparent");
        label.style.borderColor = "#ffb81d";
      });
    });

    // 3) Envoi
    btn.addEventListener("click", () => {
      const city = input.value.trim();
      if (!city || !choixCoupure || !validCities.includes(city)) {
        alert("Merci de choisir une ville valide dans la liste et de répondre à la question.");
        return;
      }
      fetch("TON_URL_APPS_SCRIPT", {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ ville: city, coupure: choixCoupure })
      });
      input.value = "";
      choixCoupure = "";
      opts.forEach(l => l.style.borderColor = "transparent");
      document.getElementById("confirmation").style.display = "block";
    });
  });
</script>
